{% trim %}

{% from 'indesign/etymology.xml'   import etymology    with context %}
{% from 'indesign/meaning_without_children.xml' import meaning with context %}

<entry>
    <p aid:pstyle="FirstParagraph">

    {% for base_var in entry.base_vars %}

        <headword>{{ base_var.idem_ucs }}</headword>
        {% if loop.first %}
            {% if entry.homonym_order %}
                <homonym-number>{{ entry.homonym_order }}</homonym-number>
                {{ space }}
            {% endif %}
            {% if entry.questionable_headword %}
                <questionable>(?)</questionable>
            {% endif %}
        {% endif %}
        {{ space }}

        {% for var in base_var.childvars %}

            {% if loop.first %}
                {{ space }}<text>(</text>
            {% endif %}

            <var>{{ var.idem_ucs }}</var>

            {% if loop.last %}
                {{ backspace }}<text>)</text>{{ space }}
            {% else %}
                {{ backspace }}<text>,</text>{{ space }}
            {% endif %}

        {% endfor %}

    {% endfor %}


    {% if entry.short_form or entry.genitive or entry.sg1 or entry.sg2 %}
        {{ backspace }}<text>,</text>{{ space }}
    {% endif %}


    {% if entry.short_form %}
        {% if entry.short_form_ucs_wax.0 %}{{ nbhyphen }}{% endif %}
        <csl>{{ entry.short_form_ucs_wax.1|ind_cslav_words }}</csl>
        {{ space }}
    {% endif %}

    {% if entry.genitive %}
        {% if entry.genitive_ucs_wax.0 %}{{ nbhyphen }}{% endif %}
        <csl>{{ entry.genitive_ucs_wax.1|ind_cslav_words }}</csl>
        {{ space }}
    {% endif %}

    {% if entry.sg1 %}
        {% if entry.sg1_ucs_wax.0 %}{{ nbhyphen }}{% endif %}
        <csl>{{ entry.sg1_ucs_wax.1|ind_cslav_words }}</csl>
        {% if entry.sg2 %},{%endif %}
        {{ space }}
    {% endif %}

    {% if entry.sg2 %}
        {% if entry.sg2_ucs_wax.0 %}{{ nbhyphen }}{% endif %}
        <csl>{{ entry.sg2_ucs_wax.1|ind_cslav_words }}</csl>
        {{ space }}
    {% endif %}

    {% if entry.uninflected %}
        <i>неизм.</i>
        {{ space }}
    {% endif %}

    {% if entry.possessive %}
        <i>притяж.</i>
        {{ space }}
    {% endif %}


    {% if entry.participle_type %}
        <i>{{ entry.get_participle_type_display() }}</i>
        {{ space }}
    {% else %}
        {% if entry.part_of_speech %}
            {% if not entry.is_part_of_speech("letter") and
                  not entry.is_part_of_speech("number") and
                  not entry.is_part_of_speech("noun") %}
            <i>{{ entry.get_part_of_speech_display() }}</i>
            {% endif %}
        {% endif %}

        {{ space }}
        {% if entry.gender %}
            {{ backspace }},{{ space }}
            <i>{{ entry.get_gender_display() }}</i>
            {{ space }}
        {% endif %}
    {% endif %}


    {% if entry.tantum %}
        <i>{{ entry.get_tantum_display() }}</i>
        {{ space }}
    {% endif %}

    {% if entry.is_onym('ethnonym') and entry.nom_sg %}
        <i>мн.</i>
        {{ space }}
        {% if entry.nom_sg_ucs_wax.0 %}{{ nbhyphen }}{%endif %}
        <csl>{{ entry.nom_sg_ucs_wax.1|ind_cslav_words }}</csl>
    {% endif %}


    {% for etym in entry.etymologies %}

        {% set prevLang = Lang %}
        {% set Lang = etym.get_language_display() %}
        {% set isLanguageChanged = (Lang != prevLang) %}

        {{ etymology(etym, isLanguageChanged, loop) }}

    {% endfor %}


    {% if entry.is_onym('anthroponym') %}
        <i>имя собств.</i>
        {% if entry.canonical_name %}
            <text>,</text>{{ space }}
            <i>канонич.</i>
        {% endif %}
        {{ space }}
    {% endif %}

    {% if entry.is_onym('toponym') %}
        <i>топоним</i>{{ space }}
    {% endif %}


    {% for m in entry.meanings %}
        {% set mnumber = loop.index %}
        {% if not entry.meanings|length == 1 %}
            <meaning-number>{{ mnumber }}.</meaning-number>{{ space }}
        {% endif %}

        {% include 'indesign/meaning_with_children.xml' with context %}

        {% for cg in m.collogroups %}
            {% include 'indesign/collogroup.xml' %}
        {% endfor %}
    {% endfor %}


    {% for m in entry.metaph_meanings %}
        {% include 'indesign/litsym.xml' %}
        {{ meaning(m, peer_meanings_loop=loop,
                      parent_meanings_loop=none,
                      child_meanings=none) }}
        {% for cg in m.collogroups %}
            {% include 'indesign/collogroup.xml' %}
        {% endfor %}
    {% endfor %}

    {% for cg in entry.collogroups %}
        {% include 'indesign/collogroup.xml' %}
    {% endfor %}


    {% if entry.cfentries or entry.cfcollogroups %}
        <i>—Ср.{{ nbsp }}</i>

        {% for cfe in entry.cfentries %}

            {% if not loop.first and
                    not (loop.last and not entry.cfcollogroups) %}
                {{ backspace }}<text>,</text>{{ space }}
            {% endif %}

            <csl>{{ cfe.orth_vars.0.idem_ucs|ind_cslav_words }}</csl>

            {% if cfe.homonym_order %}
                <homonym-number>{{ cfe.homonym_order }}</homonym-number>
            {% endif %}
        {% endfor %}

        {% for cfcg in entry.cfcollogroups %}
            {% if (not loop.first or entry.cfentries) and not loop.last %}
                {{ backspace }}<text>,</text>{{ space }}
            {% endif %}
            <csl>{{ cfcg.collocations.0.collocation_ucs|ind_cslav_words }}</csl>
        {% endfor %}
        {{ backspace }}<text>.</text>
    {% endif %}

    </p>{{ newline }}
</entry>

{# vim: set ft=django.xml: #}
{% endtrim %}
