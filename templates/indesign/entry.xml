{% trim %}

{% from '_etymology.xml'   import etymology    with context %}
{% from '_meaning_without_children.xml' import meaning with context %}

<entry>

    {% for base_var in entry.base_vars %}

        <headword>{{ base_var.idem_ucs }}</headword>
        {% if loop.first %}
            {% if entry.homonym_order %}
                <homonym-number>{{ entry.homonym_order }}</homonym-number>
                {{ space }}
            {% endif %}
            {% if entry.questionable_headword %}
                <questionable>(?)</questionable>
            {% endif %}
        {% endif %}
        {{ space }}

        {% for var in base_var.children %}

            {% if loop.first %}
                {{ space }}<text>(</text>
            {% endif %}

            <var>{{ var.idem_ucs }}</var>

            {% if loop.last %}
                {{ backspace }}<text>)</text>{{ space }}
            {% else %}
                {{ backspace }}<text>,</text>{{ space }}
            {% endif %}

        {% endfor %}

    {% endfor %}


    {% if entry.short_form or entry.genitive or entry.sg1 or entry.sg2 %}
        {{ backspace }}<text>,</text>{{ space }}
    {% endif %}


    {% if entry.short_form %}
        {% if entry.short_form_ucs_wax.0 %}{{ nbhyphen }}{% endif %}
        <csl>{{ entry.short_form_ucs_wax.1|ind_cslav_words }}</csl>
        {{ space }}
    {% endif %}

    {% if entry.genitive %}
        {% if entry.genitive_ucs_wax.0 %}{{ nbhyphen }}{% endif %}
        <csl>{{ entry.genitive_ucs_wax.1|ind_cslav_words }}</csl>
        {{ space }}
    {% endif %}

    {% if entry.sg1 %}
        {% if entry.sg1_ucs_wax.0 %}{{ nbhyphen }}{% endif %}
        <csl>{{ entry.sg1_ucs_wax.1|ind_cslav_words }}</csl>
        {% if entry.sg2 %},{%endif %}
        {{ space }}
    {% endif %}

    {% if entry.sg2 %}
        {% if entry.sg2_ucs_wax.0 %}{{ nbhyphen }}{% endif %}
        <csl>{{ entry.sg2_ucs_wax.1|ind_cslav_words }}</csl>
        {{ space }}
    {% endif %}

    {% if entry.uninflected %}
        <i>неизм.</i>
        {{ space }}
    {% endif %}

    {% if entry.possessive %}
        <i>притяж.</i>
        {{ space }}
    {% endif %}


    {% if entry.participle_type %}
        <i>{{ entry.get_participle_type_display() }}</i>
        {{ space }}
    {% else %}
        {% if entry.part_of_speech %}
            {% if not entry.is_part_of_speech("letter") and
                  not entry.is_part_of_speech("number") and
                  not entry.is_part_of_speech("noun") %}
            <i>{{ entry.get_part_of_speech_display() }}</i>
            {% endif %}
        {% endif %}

        {{ space }}
        {% if entry.gender %}
            {{ backspace }},{{ space }}
            <i>{{ entry.get_gender_display() }}</i>
            {{ space }}
        {% endif %}
    {% endif %}


    {% if entry.tantum %}
        <i>{{ entry.get_tantum_display() }}</i>
        {{ space }}
    {% endif %}

    {% if entry.is_onym('ethnonym') and entry.nom_sg %}
        <i>мн.</i>
        {{ space }}
        {% if entry.nom_sg_ucs_wax.0 %}{{ nbhyphen }}{%endif %}
        <csl>{{ entry.nom_sg_ucs_wax.1|ind_cslav_words }}</csl>
    {% endif %}


    {% for etym in entry.etymologies %}

        {% set prevLang = Lang %}
        {% set Lang = etym.get_language_display() %}
        {% set isLanguageChanged = (Lang != prevLang) %}

        {{ etymology(etym, isLanguageChanged, loop) }}

    {% endfor %}


    {% if entry.is_onym('anthroponym') %}
        <i>имя собств.</i>
        {% if entry.canonical_name %}
            <text>,</text>{{ space }}
            <i>канонич.</i>
        {% endif %}
        {{ space }}
    {% endif %}

    {% if entry.is_onym('toponym') %}
        <i>топоним</i>{{ space }}
    {% endif %}


    {# <<<<<<<<<<<<<<< #}


    {% if entry.link_to_entry or entry.link_to_collogroup or entry.link_to_meaning %}
    <div>
        <i>см.</i>
        {{ space }}

        {% if entry.link_to_meaning %}
                {% set eltm = entry.link_to_meaning %}
                {% if eltm.entry_container %}
                    <a href="{{ eltm.entry_container.get_absolute_url() }}">
                        <span class="cslav">
                            {{ eltm.entry_container.orth_vars.0.idem_ucs }}
                        </span>
                        {% if eltm.entry_container.homonym_order %}
                            <sup class="homonym-number">{{ eltm.entry_container.homonym_order }}</sup>
                        {% endif %}
                    </a>
                {% endif %}
                {% if eltm.collogroup_container %}
                    <span class="cslav">
                        {{ eltm.collogroup_container.collocations.0.collocation_ucs }}
                    </span>
                {% endif %}
                {{ space }}<i>знач.</i>{{ space }}{{ eltm.order }}
        {% endif %}

        {% if entry.link_to_entry %}
            <a href="{{ entry.link_to_entry.get_absolute_url() }}">
                <span class="cslav">
                    {{ entry.link_to_entry.orth_vars.0.idem_ucs }}
                </span>
                {% if entry.link_to_entry.homonym_order %}
                    <sup class="homonym-number">{{ entry.link_to_entry.homonym_order }}</sup>
                {% endif %}
            </a>
        {% endif %}

        {% if entry.link_to_collogroup %}
            <span class="cslav">
                {{ entry.link_to_collogroup.collocations.0.collocation_ucs }}
            </span>
        {% endif %}
    </div>
    {% endif %}


    {% if entry.cfentries or entry.cfcollogroups or entry.cfmeanings %}
    <div>
        <i>ср.&nbsp;</i>

        {% for cfm in entry.cfmeanings %}
            {% if not loop.first %}
                {{ backspace }},{{ space }}
            {% endif %}
            {% if cfm.entry_container %}
                <a href="{{ cfm.entry_container.get_absolute_url() }}">
                    <span class="cslav">
                        {{ cfm.entry_container.orth_vars.0.idem_ucs }}
                    </span>
                    {% if cfm.entry_container.homonym_order %}
                        <sup class="homonym-number">{{ cfm.entry_container.homonym_order }}</sup>
                    {% endif %}
                </a>
            {% endif %}
            {% if cfm.collogroup_container %}
                <span class="cslav">
                    {{ cfm.collogroup_container.collocations.0.collocation_ucs }}
                </span>
            {% endif %}
            {{ space }}<i>знач.</i>{{ space }}{{ cfm.order }}
        {% endfor %}

        {% for cfe in entry.cfentries %}
            {% if not loop.first or entry.cfmeanings %}
                {{ backspace }},{{ space }}
            {% endif %}
            <a href="{{ cfe.get_absolute_url() }}">
                <span class="cslav">
                    {{ cfe.orth_vars.0.idem_ucs }}
                </span>
                {% if cfe.homonym_order %}
                    <sup class="homonym-number">{{ cfe.homonym_order }}</sup>
                {% endif %}
            </a>
        {% endfor %}

        {% for cfcg in entry.cfcollogroups %}
            {% if not loop.first or entry.cfmeanings or entry.cfentries %}
                ,{{ space }}
            {% endif %}
            <span class="cslav">
                {{ cfcg.collocations.0.collocation_ucs }}
            </span>
        {% endfor %}

    </div>
    {% endif %}


    {% for m in entry.meanings %}

        <div class="eM--meaning">
            {% set mnumber = loop.index %}

            {% if not entry.meanings|length == 1 %}
                <b>{{ mnumber }}</b>.{{ space }}
            {% endif %}

            {% include '_meaning_with_children.html' with context %}

        </div>


        {% if m.collogroups %}
            <div class="entry-collogroups">
                {% for cg in m.collogroups %}
                    {% include '_collogroup.html' %}
                {% endfor %}
            </div>
        {% endif %}


    {% endfor %}


    {% for m in entry.metaph_meanings %}

        <div class="eM--meaning">

            <span style="color: #777;">►</span>
            {{ space }}
            {{ meaning(m, peer_meanings_loop=loop,
                          parent_meanings_loop=none,
                          child_meanings=none) }}



        </div>

        {% if m.collogroups %}
            <div class="entry-collogroups">
                {% for cg in m.collogroups %}
                    {% include '_collogroup.html' %}
                {% endfor %}
            </div>
        {% endif %}

    {% endfor %}

    {% if entry.collogroups %}
        <div class="entry-collogroups">
            {% for cg in entry.collogroups %}
                {% include '_collogroup.html' %}
            {% endfor %}
        </div>
    {% endif %}

</entry>

{# vim: set ft=django.html: #}
{% endtrim %}
