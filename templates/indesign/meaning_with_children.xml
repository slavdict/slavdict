{% from 'indesign/meaning_without_children.xml' import meaning with context %}
{% from 'indesign/valency.xml' import valency with context %}
{% set child_meanings = m.child_meanings %}
{% set parent_meanings_loop = loop %}

{{ meaning(m, peer_meanings_loop=loop,
              parent_meanings_loop=none,
              child_meanings=child_meanings) }}

{% for m in child_meanings %}

    {% if m.metaphorical %}
        {% include 'indesign/allusion.xml' %}
    {% elif loop.first and m.is_valency and not m.parent_meaning.examples %}
        {{ backspace }}<text aid:cstyle="Text">:</text>{{ space }}
    {% elif loop.first and not m.metaphorical and not m.parent_meaning.examples %}
        {{ backspace }}<text aid:cstyle="Text">;</text>{{ space }}
    {% elif not m.metaphorical %}
        {% include 'indesign/separator.xml' %}
    {% endif %}

    {% if m.is_valency %}
        {{ valency(m) }}
    {% else %}
        {{ meaning(m, peer_meanings_loop=loop,
                      parent_meanings_loop=parent_meanings_loop,
                      child_meanings=none) }}
    {% endif %}
{% endfor %}

{# vim: set ft=django.xml: #}
