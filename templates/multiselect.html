<!DOCTYPE html>
<html>
<head>
    <title>Мультиселект</title>
</head>
<body>
    <style>
.multiselect {
    width: 200px;
    min-height: 25px;
    background-color: #ccc;
    -moz-border-radius: 4px;
    -webkit-border-radius: 4px;
    border-radius: 4px;
    padding: 2px 7px;
    line-height: 25px;
}
.option {
    min-height: 20px;
    background-color: #fff;
    -webkit-border-radius: 4px;
    -moz-border-radius: 4px;
    border-radius: 4px;
    padding: 0 4px;
    white-space: nowrap;
}
.x {
    background-color: #a00;
    -webkit-border-radius: 7px;
    -moz-border-radius: 7px;
    border-radius: 7px;
    color: #fff;
    line-height: 12px;
    font-family: sans;
    font-size: 10px;
    cursor: pointer;
}
.multiselect input {
    width: 180px;
    border-width: 0;
    background-color: #ccc;
    font-family: Verdana;
    font-size: 12px;
    color: #777;
    outline-width: 0;
}
.multiselect input.empty {
    font-size: 11px;
    font-style: italic;
    color: #999;
}
.msList {
    position: absolute;
    top: 30px;
    width: 180px;
    max-height: 180px;
    padding: 0;
}
.msList ul {
    margin: 0;
    padding: 0;
}
.msList li {
    list-style-type: none;
    width: 140px;
    display: block;
    margin: 0;
    padding: 0 4px;
    border: 1px solid #ccc;
    background-color: #fff;
}
.msList li.focused,
.msList li:hover {
    background-color: #777;
    color: #fff;
}
    </style>

<!-- --------------------------------- -->
    <select multiple="multiple"
            data-bind="options: selectedEntries,
                selectedOptions: selectedEntries,
                optionsText: 'civil',
                optionsValue: 'pk'"></select>

    <table>
        <tr>
            <td style="position: relative;">
                <input type="text" placeholder="..." data-bind="value: prefixQuery, valueUpdate: 'afterkeydown'" />
                <div class="msList">
                    <ul data-bind="template: {name: 'listTemplate', foreach: entries}"></ul>
                </div>
            </td>
            <td>
                <div class="multiselect"
                     data-bind="template: {name: 'entriesTemplate', foreach: selectedEntries}"></div>
            </td>
        </tr>
    </table>

    Having followed the MVVM pattern and got an object-oriented representation of the UI's data and behaviors, you're in
    a great position to sprinkle on extra behaviors in a very natural and convenient way.

    For example, if you're asked to display the total number of seats being reserved, you can implement that in just a
    single place, and you don't have to write any extra code to make the seat count update when you add or remove items.
    Just update the at the top of your view:

    <script type="text/x-jquery-tmpl" id="entriesTemplate">
        <span class="option">
            <span class="entry" data-bind="text: civil"></span>
            <span class="hom" data-bind="text: hom"></span>
            <span class="pos" data-bind="text: pos"></span>
            <span class="hint" data-bind="text: hint"></span>
            <span class="x" data-bind="click: function(){ viewModel.removeEntry($data); }">&times;</span></span>&#32;
    </script>

    <script type="text/x-jquery-tmpl" id="listTemplate">
        <li data-bind="css: { focused: $data == viewModel.focusedEntry() }, click: function(){ viewModel.selectEntry($data); }">
            <span class="entry" data-bind="text: civil"></span>
            <span class="hom" data-bind="text: hom"></span>
            <span class="pos" data-bind="text: pos"></span>
            <span class="hint" data-bind="text: hint"></span>
        </li>
    </script>


    <script type='text/javascript' src='{{ STATIC_URL }}jquery-1.6.2.min.js'></script>
    <script type='text/javascript' src='{{ STATIC_URL }}jquery.tmpl.min.js'></script>
    <script type='text/javascript' src='{{ STATIC_URL }}knockout-1.2.1.js'></script>
    <script>
        var viewModel = {
            prefixQuery: ko.observable(),
            focusedEntry: ko.observable(),
            entries: ko.observableArray(),
            selectedEntries: ko.observableArray(),
            selectEntry: function(e) {
                this.selectedEntries.push(e);
                this.entries.splice(0);
            },
            removeEntry: function(e) {
                for (var i=0; i<this.selectedEntries.length; i++) {
                    if (e == this.selectedEntries[i]) {
                        this.selectedEntries().splice(i, 1);
                        break;
                    }
                }
            }
        };
        ko.applyBindings(viewModel);

        ko.dependentObservable(function() {
            if (this.lastEntriesRequest) this.lastEntriesRequest.abort();
            if (this.prefixQuery()) {
                this.lastEntriesRequest = $.get(
                        "/json/entries/",
                        { find: this.prefixQuery() },
                        this.entries
                );
            } else { this.entries.splice(0); }
        }, viewModel);
    </script>

</body>
</html>
