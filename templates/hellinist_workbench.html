{% extends 'base.html' %}
{% from '_hellinist_example.html' import example with context %}
{% from '_hellinist_entry.html' import entry with context %}

{% block css %}hellinist_workbench.css{% endblock %}
{% block headerFormAddress %}{{ url('hellinist_workbench') }}{% endblock %}

{% block header %}

    <a href="{{ url('all_entries_url') }}" class="header--item button">
        Выход из греческого кабинета
    </a>
    {{ space }}

    {% if entries %}
        <a href="{{ url('hellinist_workbench') }}" class="header--item button">
            Параллели к иллюстрациям
        </a>
    {% else %}
        <a href="{{ url('hellinist_entries') }}" class="header--item button">
            Параллели к статьям
        </a>

        {% if indicators.meaning %}
            <span class="header--item indicator"
                data-bind="click: function(){
                                      vM.filters.getDefaultState();
                                      vM.filters.hwStatus('M');
                                      vM.filters.formSubmit();
                                  }" >
                Необх. для опр. значения{{ space }}
                <span>{{ indicators.meaning }}</span>
            </span>
        {% endif %}

        {% if indicators.urgent %}
            <span class="header--item indicator"
                data-bind="click: function(){
                                      vM.filters.getDefaultState();
                                      vM.filters.hwStatus('U');
                                      vM.filters.formSubmit();
                                  }" >
                Срочных греч. парал.{{ space }}
                <span>{{ indicators.urgent }}</span>
            </span>
        {% endif %}
    {% endif %}

{% endblock %}

{% block subheader %}
    {% if entries %}
        {% include '_entry_filters.html' %}
    {% else %}
        {% include '_examples_filters.html' %}
    {% endif %}
{% endblock %}

{% block content %}
    {% trim %}
    {% if entries %}

        {% for e in entries %}
            <div>{{ entry(e) }}</div>
        {% endfor %}

    {% else %}

        {% for e in examples %}
            <div>{{ example(e, loop.changed(e.host), loop.index0) }}</div>
        {% endfor %}

    {% endif %}
    {% endtrim %}
    {% include '_pagination.html' %}
{% endblock %}

{% block javascript_links %}

<script src="{{ STATIC_URL }}js/libs/ac2ucs8.js?{{ STATIC_RESOURCES_VERSION }}"
        type="text/javascript" charset="utf-8"></script>

<script src="{{ STATIC_URL }}js/myKnockoutCommon.js?{{ STATIC_RESOURCES_VERSION }}"
        type="application/javascript" charset="utf-8"></script>

    <script>

        var vM = {};

        vM.urls = {
            jsonGreqDeleteURL: "{{ url('jsonGreqDeleteURL') }}",
            jsonGreqSaveURL: "{{ url('jsonGreqSaveURL') }}",
            jsonExSaveURL: "{{ url('jsonExSaveURL') }}"
        };

        vM.meta = {
            initials: [],
            defaults: []
        };

        {% set filters = form.cleaned_data %}
        vM.valuesToInitialize = {
            hwAuthor: '{{ filters.hwAuthor }}',
            hwAddress: '{{ filters.hwAddress }}',
            hwPrfx: '{{ filters.hwPrfx }}',
            hwExample: '{{ filters.hwExample }}',
            hwExamplesIds: '{{ filters.hwExamplesIds }}',
            hwSortbase: '{{ filters.hwSortbase }}',
            hwSortdir: '{{ filters.hwSortdir }}',
            hwStatus: '{{ filters.hwStatus }}'
        };

        vM.listsForWidgets = {
            authors: {{ viewmodel.authors }},
            sortbase: {{ viewmodel.sortbase }},
            sortdir: {{ viewmodel.sortdir }},
            statuses: {{ viewmodel.statuses }}
        };

        vM.jsonExamples = {{ jsonExamples|safe }};

    </script>

    <script src="{{ STATIC_URL }}js/hellinistFilters.js?{{ STATIC_RESOURCES_VERSION }}"
        type="application/javascript" charset="utf-8"></script>

{% endblock %}
