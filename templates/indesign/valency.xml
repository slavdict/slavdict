{% macro valency(m, peer_meanings_loop, parent_meanings_loop, child_meanings) %}
{% from 'indesign/example.xml' import example with context %}

{% if m.meaning %}
    {{ m.host_entry.base_vars[0].idem_ucs|ind_cslav_words("CSLSegmentEm", "Text") }}{{ space }}
    {% for frame in m.meaning.split(";") %}
        {% if loop.first %}
            {# pass #}
        {% elif loop.last %}
            {{ backspace }}{{ space }}<x aid:cstyle="Em">или</x>{{ space }}
        {% else %}
            {{ backspace }}<x aid:cstyle="Text">;</x>{{ space }}
        {% endif %}
        <x aid:cstyle="Text">{{ frame|trim|
            ind_cslav_injection("CSLSegmentEm")|
            ind_regex('Valency', '[а-я]+[\\-\u2011]л\\.')|
            ind_regex('Em', 'с\\s(?:придат|инф)\\.') }}</x>
        {{ space }}
    {% endfor %}
{% endif %}

{% if m.gloss %}
    {{ backspace }}{{ space }}
    <x aid:cstyle="Text">(=</x>{{ nbsp }}
    <x aid:cstyle="Text">{{ m.gloss|ind_cslav_injection("CSLSegment") }}</x>
    <x aid:cstyle="Text">)</x>
    {{ space }}
{% endif %}

{% for e in m.examples %}
    {{ example(e, examples_loop=loop,
               peer_meanings_loop=peer_meanings_loop,
               parent_meanings_loop=parent_meanings_loop,
               child_meanings=child_meanings) }}
{% endfor %}


{% endmacro %}
{# vim: set ft=django.xml: #}
